<button
  pButton
  class="p-button-rounded"
  icon="pi pi-plus"
  (click)="openAddItemDialog()"
></button>

<p-menu #menu [popup]="true" [model]="menuItems"></p-menu>
<button
  pButton
  class="p-button-text"
  icon="pi pi-chevron-down"
  (click)="menu.toggle($event)"
></button>

<form [formGroup]="itemsForm">
  <ng-container
    *ngFor="let item of itemsForm.controls | keyvalue"
    [formGroupName]="item.key"
  >
    <div class="header">
      <div class="description">
        {{ bill.items[item.key].description }}
      </div>
      <div class="price">Â£{{ bill.items[item.key].cost }}</div>
    </div>
    <div formGroupName="sharedBy" class="sharedBy-grid">
      <div
        class="p-mb-2"
        [ngClass]="{ 'justify-self-right': j % 2 === 1 }"
        *ngFor="
          let sharedBy of sharedByForm(item.key).controls | keyvalue;
          let j = index
        "
        [formGroupName]="sharedBy.key"
      >
        <label class="p-mr-2" *ngIf="j % 2 === 1">{{
          bill.items[item.key].sharedBy[sharedBy.key].user
        }}</label>
        <p-inputSwitch
          formControlName="settled"
          pTooltip="Can't edit the original payer of the item"
          [tooltipDisabled]="
            bill.items[item.key].sharedBy[sharedBy.key].user !==
            bill.items[item.key].paidBy
          "
          tooltipPosition="top"
          (onChange)="
            settledChange$.next({
              checked: $event.checked,
              itemKey: item.key,
              sharedByKey: sharedBy.key,
              billId: bill.uid
            })
          "
        ></p-inputSwitch>
        <label class="p-ml-2" *ngIf="j % 2 === 0">{{
          bill.items[item.key].sharedBy[sharedBy.key].user
        }}</label>
      </div>
    </div>
    <hr />
  </ng-container>
</form>

<p-dialog
  header="Add Item"
  [(visible)]="displayAddItemDialog"
  [style]="{ width: '100%' }"
>
  <bc-add-item
    [users]="bill.usersArray"
    (addItem)="
      addItem.emit({ newItem: $event, bill: bill }); closeAddItemDialog()
    "
  ></bc-add-item>
</p-dialog>

<p-dialog
  header="Add Users and Editors"
  [(visible)]="displayAddUsersDialog"
  [style]="{ width: '100%' }"
>
  <!-- <bc-add-item
    [users]="bill.usersArray"
    (addItem)="
      addItem.emit({ newItem: $event, bill: bill }); closeAddItemDialog()
    "
  ></bc-add-item> -->
</p-dialog>
